Ola professor,

Depois de aplicar as sugestões que deu o nosso ER (anexado neste email) ficou assim:

 

Eu só gostaria de confirmar se a forma como estamos a pensar faz sentido. Imaginemos a seguinte situação:

- Cliente entra na loja
- Cliente adiciona 1 maca e 2 peras ao carrinho
- Cliente efetua a compra

Assumindo que todas as tabelas na base de dados estão vazias (com exceção das tabelas category, manufacturer e item) as operações que ocorreriam na base de dados são:

- Cliente entra na lojaA forma que estamos a pensar sobre isso e que basicamente "entrar na loja" e simplesmente acessar ao nosso programa de testes de api, no nosso caso seria o Postman, portanto nós como clientes logo ao abrirmos o Postman e como se já estivessemos dentro do nosso website na nossa conta com o login já efetuado. Estamos cientes que se simplesmente abrirmos o Postman e não efetuarmos nenhum http request a api, a nossa tabela "client" continuará vazia ou seja tecnicamente ainda não somos clientes mas tendo em conta que não vamos implementar nenhuma feature relacionada ao login decidimos adotar esta convenção.

- Cliente adiciona 1 maca e 2 peras ao carrinhoNo enunciado do projeto existe um endpoint que temos de implementar - 4. Add Item to Shopping Cart (POST) - para adicionar itens ao nosso carrinho, sendo que, para o mesmo ser ativado temos que fazer um POST request para a seguinte url: https://localhost:8080/proj/api/cart. Inicialmente ficamos confusos pois olhando para a url (inclusive a request body do POST no enunciado) não temos efetivamente informação alguma sobre como identificar o id do "cart" ao qual vamos adicionar, afinal de contas podia ser qualquer cliente a fazer o request para aquela endpoint certo? Esta confusão deve-se ao facto de que até esse momento ainda não se havia adotado a convenção mencionada no ponto anterior pois a partir do momento em que a adotamos ficou claro que fazer requests no Postman e o mesmo que fazer requests de dentro do nosso site, mais especificamente de dentro da nossa conta de cliente e portanto o id do cart a que devemos adicionar e único, nesse caso o id do cart a que nos pertence. Seguindo esse raciocínio ao adicionarmos maçãs e peras ao carrinho o que acontece efetivamente na base de dados e:

1. Adicionamos a tabela "client" um novo cliente com um id auto-incrementado2. Criamos um carrinho associado a esse cliente na tabela "cart" com um id auto-incrementado
3. Adicionamos informação sobre os produtos e as quantidades presentes nesse carrinho na tabela "cart_item"
Ora, se realmente estamos a seguir um raciocínio correto até agora os passos descritos acima tem alguma implicações:Na nossa base de dados nunca vão existir clientes que tenham a informação do nome e email preenchidas (volto a repetir que estamos a assumir que o programa começa com a tabela "client" vazia e o grupo que faz o trabalho contém apenas 2 elementos) isto porque segundo a lógica que vimos até agora nós assumimos que o cliente ao abrir o postman já está com o login feito e em principio ja havia de ter lá na base de dados informação sobre o seu nome e email mas como explicamos no primeiro ponto (- cliente entra na loja) não é esse o caso.Tendo em conta o que vimos até agora seria normal e até mesmo lógico assumir que a jornada do cliente seria 1. entrar no site, 2. adicionar itens no carrinho e 3. comprar os itens que estão nesse carrinho, portanto o óbvio próximo passo agora seria implementar um endpoint que nos permitisse a nós como clientes pegar no carrinho que já criamos, já com os produtos que fomos adicionando enquanto passeávamos pela loja e efetuar a compra, no entanto como já vamos ver no ponto seguinte (- Cliente efetua a compra) o processo de compra especificado pelo enunciado (9. Purchase Items (POST)) não nos permite aproveitar os carrinhos já criados pelo que temos que criar um novo carrinho no request body do POST, ou seja, podemos adicionar e remover itens do nosso carrinho mas não existe nenhuma feature que nos permita levar esse mesmo carrinho a fase final que nesse caso seria a compra dos produtos contidos nele.


- Cliente efetua a compraSegundo o enunciado, para efetuar a compra temos que fazer um POST request para a seguinte url: http://localhost:8080/proj/api/purchase sendo que a informação contida no request body são o carrinho com os seus produtos e o id do cliente, isso mesmo, o id do cliente, ou seja o paradigma mudou, agora estar no Postman ja nao e considerado estar dentro do site com o login já feito, agora estar no Postman e mais como se fossemos um administrador que consegue aplicar compras a qualquer cliente que ele quiser (endpoints como o create item e o update item também são responsabilidades de um admin), isto pode parecer trivial mas isso foi o fruto de bastante confusão, pelo menos do meu lado eu sempre olhei para o problema do ponto de vista de um administrador e por isso mesmo e que na hora de adicionar produtos no carrinho eu fiquei confuso por não haver lá a possibilidade de escolher o id do cart do qual vamos adicionar. Passei bastante tempo a tentar entender essa lógica e creio ainda não ter percebido bem e por isso estou a mandar este email.

Se combinarmos o facto de que, segundo a sugestão do professor, um cliente só pode ter no máximo um carrinho, com o facto de que o carrinho associado ao processo de compra e diferente do carrinho criado quando vamos adicionando produtos, alguns problemas começam a aparecer, por exemplo:
Se eu entrar no Postman e fazer um POST request para adicionar itens ao carrinho, o mesmo será criado automaticamente e se eu depois na mesma sessão quiser associar uma compra a esse mesmo cliente com um carrinho já criado vai dar problemas pois um cliente pode ter no máximo um carrinho e o processo de compra envolve criar um novo carrinho para o cliente em causa, mas nesse caso a solução até é simples, simplesmente apagamos o carrinho que lá está e adicionamos o novo no entanto isto envolve perder a informação do carrinho anterior.Quando formos efetivamente fazer a compra é óbvio que temos de ter em conta o stock dos produtos, fazer uso de transações, calcular os preços e etc...No entanto, assumindo que a compra é efetuada com sucesso, como é que devem ficar as tabelas "cart" e "cart_items"? Uma vez que a informação relativa a compra está nas tabelas "purchase" e "purchase_items" então quer dizer que após a compra ser efetuada com sucesso temos de ir a tabela "cart" apagar os itens do carrinho do cliente em causa para que o mesmo possa voltar noutra hora e fazer de novo uma compra (seria inconveniente para os nossos bolsos se o carrinho acumulasse permanentemente produtos).