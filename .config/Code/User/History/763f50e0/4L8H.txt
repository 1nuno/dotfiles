
docker run -d --name kafka --network kafka-network -e ALLOW_PLAINTEXT_LISTENER=yes -e KAFKA_CFG_ZOOKEEPER_CONNECT=kafka-zookeeper:2181 -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CLIENT:PLAINTEXT,EXTERNAL:PLAINTEXT -e KAFKA_CFG_LISTENERS=CLIENT://:9092,EXTERNAL://:9093 -e KAFKA_CFG_ADVERTISED_LISTENERS=CLIENT://kafka:9092,EXTERNAL://172.16.140.128:9093 -e KAFKA_CFG_INTER_BROKER_LISTENER_NAME=CLIENT -p 9092:9092 -p 9093:9093 
bitnami/kafka:latest

do $$
declare
	x varchar(10);
begin
	x = 'impar';
	for i in 1..10
	loop 
		insert into temp
		values (i,i*100, 'col1 e'||x);
		
		if (x='impar') then
			x='par';
		else
			x='impar';
		end if;
	end loop;
end;
$$;


create or replace procedure ex3(p_livro livros.id_livro%type)
language plpgsql
as $$
declare
	v_id_autor autores.id_autor%type;
begin
	insert into autorers(if_autor, nome, morada, sexo, nacionalidade, genero)
	values(80,'luis moreno','lisboa','masculino','mocambicana','informatica')
	
	select id_autor into strict v_id_autor
	from livros l
	where id_livro=p_livro;
	
	if (v_id_autor=17) then
		update livros set id_autor=80
		where id_livro=p_livro;
	end if;
end;
$$;

select * from livros where id_autor=17;



5
create or replace procedure ex3(p_livro livros.id_livro%type)
language plpgsql
as $$
declare
	v_preco livros.preco%type;
	v_genero livros.genero%type;
begin
	select preco, genero into strict v_preco, v_genero
	from livros
	where id_livro=p_livro;
	
	if v_genero <> 'Aventura' then
		if v_preco < 25 then
			update livros set preco=preco*1.1
			where id_livro = p_livro;
		else
			update livros set preco=preco*1.06
			where id_livro = p_livro;
		end if;
	end if;
end;
$$;

call ex3(1);

select * from livros;